<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI ì…°í”„ì˜ ì£¼ë°©</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        :root {
            --background: #F2F4F6; --white: #FFFFFF; --text-main: #191F28; --text-sub: #4E5968; --text-hint: #8B95A1;
            --primary-color: #FF6B6B; --secondary-color: #FFB800; --creative-color: #9B59B6; --strict-color: #00B894;
            --shadow-card: 0 2px 16px rgba(0, 0, 0, 0.06); --radius-l: 24px; --radius-m: 16px; --radius-s: 12px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--background); color: var(--text-main); margin: 0; padding: 0; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 520px; padding: 20px; display: flex; flex-direction: column; gap: 24px; padding-bottom: 100px; }
        
        .watermark { position: fixed; top: 20px; right: 20px; font-size: 0.75rem; font-weight: 700; color: rgba(0, 0, 0, 0.15); text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5); pointer-events: none; z-index: 9999; text-align: right; line-height: 1.4; }

        header { text-align: center; margin-top: 10px; margin-bottom: 10px; }
        .chef-icon { font-size: 2.5rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        h1 { 
            font-size: 2.2rem; margin: 0; letter-spacing: -1px; 
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        p.subtitle { color: var(--text-sub); margin: 0; font-size: 1rem; font-weight: 500; opacity: 0.8; }

        .input-container {
            background: var(--white); border-radius: var(--radius-l); padding: 8px;
            box-shadow: var(--shadow-card); display: flex; align-items: center;
            transition: transform 0.2s ease; z-index: 10; position: relative; gap: 8px;
            margin-bottom: 0;
        }
        .input-container:focus-within { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        input[type="text"] {
            flex: 1; border: none; padding: 16px; font-size: 1.1rem; 
            outline: none; background: transparent; color: var(--text-main);
            font-weight: 500; font-family: inherit; min-width: 0;
        }
        input::placeholder { color: var(--text-hint); }

        .clear-btn {
            width: 28px; height: 28px; border-radius: 50%; border: none;
            background-color: #E5E8EB; color: #8B95A1; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem; flex-shrink: 0; transition: 0.2s;
        }
        .clear-btn:hover { background-color: #d1d6db; color: #4E5968; }
        .clear-btn:active { transform: scale(0.9); }

        button#cookBtn {
            background: var(--primary-color); color: white; border: none; padding: 14px 20px;
            border-radius: var(--radius-m); font-weight: 700; font-size: 1rem; cursor: pointer;
            transition: all 0.2s; white-space: nowrap; box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
            flex-shrink: 0;
        }
        button#cookBtn:active { transform: scale(0.95); }
        button#cookBtn:disabled { background: #d1d5db; box-shadow: none; cursor: not-allowed; }

        /* ì¶”ì²œ ì¬ë£Œ ë°•ìŠ¤ */
        .recommend-box {
            background: var(--white); padding: 24px; border-radius: var(--radius-l);
            box-shadow: var(--shadow-card); display: flex; flex-direction: column; gap: 16px;
        }
        .recommend-title {
            font-size: 1rem; font-weight: 700; color: var(--text-main); margin: 0;
            display: flex; align-items: center; gap: 6px;
        }
        .recommend-title::before {
            content: ''; display: block; width: 4px; height: 16px;
            background-color: var(--secondary-color); border-radius: 4px;
        }

        .chips-row {
            display: flex; gap: 8px; overflow-x: auto; padding: 4px 2px 8px 2px;
            scrollbar-width: none; -webkit-overflow-scrolling: touch; flex-wrap: wrap;
        }
        .chips-row::-webkit-scrollbar { display: none; }

        /* ì¹© ìŠ¤íƒ€ì¼ */
        .chip {
            background: #fff; border: 1px solid #e5e8eb;
            padding: 8px 14px; border-radius: 20px;
            font-size: 0.9rem; color: var(--text-main); cursor: pointer;
            white-space: nowrap; font-weight: 600; transition: all 0.15s ease;
            box-shadow: 0 3px 0 #e5e8eb, 0 4px 4px rgba(0,0,0,0.05);
            transform: translateY(0); display: flex; align-items: center; gap: 6px;
            flex-shrink: 0;
        }
        .chip:active { transform: translateY(2px); box-shadow: 0 1px 0 #e5e8eb; }
        .chip.pressed {
            background: #f5f7fa; color: var(--primary-color); border-color: transparent;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.08), inset -2px -2px 5px rgba(255,255,255,0.8);
            transform: translateY(3px);
        }
        
        /* ì¹´í…Œê³ ë¦¬ ì¹© */
        .category-chip { background: #f2f4f6; color: var(--text-sub); border-color: transparent; box-shadow: none; }
        .category-chip.active {
            background: var(--text-main); color: white; border-color: var(--text-main);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .arrow-icon { font-size: 0.7rem; transition: transform 0.3s; }
        .category-chip.active .arrow-icon { transform: rotate(180deg); }

        /* ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì»¨í…Œì´ë„ˆ */
        .main-category-container {
            background: #f8f9fa; border-radius: 20px; 
            border: 1px solid #e5e8eb;
            overflow: hidden; max-height: 0; opacity: 0;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
        }
        .main-category-container.open {
            max-height: 1500px; opacity: 1; padding: 20px; margin-bottom: 12px;
        }

        /* ì¤‘ë¶„ë¥˜ ê·¸ë£¹ ë²„íŠ¼ */
        .sub-group-btn {
            width: 100%; text-align: left; padding: 12px 16px;
            background: white; border: 1px solid #e5e8eb; border-radius: 16px;
            font-size: 0.95rem; font-weight: 700; color: var(--text-main);
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; transition: 0.2s;
        }
        .sub-group-btn:hover { background: #f1f3f5; }
        .sub-group-btn .sub-arrow { font-size: 0.8rem; transition: transform 0.3s; color: var(--text-hint); }
        .sub-group-btn.active { background: #fff8e1; border-color: var(--secondary-color); color: #d35400; }
        .sub-group-btn.active .sub-arrow { transform: rotate(180deg); color: #d35400; }

        /* ìƒì„¸ ì¹© ì˜ì—­ */
        .sub-chips-area {
            display: flex; flex-wrap: wrap; gap: 8px; 
            max-height: 0; overflow: hidden; opacity: 0;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
        }
        .sub-chips-area.open {
            max-height: 500px; opacity: 1; margin-bottom: 16px; padding: 4px 0;
        }

        /* ìƒì„¸ ì¹© ë””ìì¸ */
        .sub-chip {
            padding: 8px 14px; background: #fff; border: 1px solid #e5e8eb; border-radius: 18px;
            font-size: 0.9rem; color: var(--text-sub); cursor: pointer;
            transition: all 0.15s ease; box-shadow: 0 2px 0 #e5e8eb; font-weight: 500;
        }
        .sub-chip:active { transform: translateY(2px); box-shadow: none; }
        .sub-chip.pressed {
            background: #e0f2f1; color: #009688; border-color: transparent;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.1); transform: translateY(2px);
        }

        /* Settings Box */
        .settings-box { background: var(--white); padding: 24px; border-radius: var(--radius-l); box-shadow: var(--shadow-card); display: flex; flex-direction: column; gap: 24px; }
        .setting-row { display: flex; flex-direction: column; gap: 12px; }
        
        .toggle-wrapper { display: flex; align-items: center; justify-content: space-between; background: #f9fafb; padding: 6px; border-radius: 30px; position: relative; }
        .toggle-option { flex: 1; text-align: center; padding: 10px 0; z-index: 2; cursor: pointer; font-size: 0.95rem; font-weight: 600; color: var(--text-hint); transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .toggle-bg { position: absolute; top: 4px; bottom: 4px; width: calc(50% - 4px); background: white; border-radius: 26px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 1; left: 4px; border: 2px solid transparent; }

        .settings-box[data-chef="conservative"] .toggle-bg.chef-bg { left: calc(50%); border-color: var(--primary-color); }
        .settings-box[data-chef="conservative"] .opt-conservative { color: var(--primary-color); }
        .settings-box[data-chef="creative"] .toggle-bg.chef-bg { left: 4px; border-color: var(--creative-color); }
        .settings-box[data-chef="creative"] .opt-creative { color: var(--creative-color); }

        .settings-box[data-season="allowed"] .toggle-bg.season-bg { left: calc(50%); border-color: var(--secondary-color); }
        .settings-box[data-season="allowed"] .opt-allowed { color: var(--secondary-color); }
        .settings-box[data-season="strict"] .toggle-bg.season-bg { left: 4px; border-color: var(--strict-color); }
        .settings-box[data-season="strict"] .opt-strict { color: var(--strict-color); }

        .desc-box { font-size: 0.9rem; color: var(--text-sub); text-align: center; line-height: 1.5; background: #F9FAFB; padding: 12px; border-radius: var(--radius-m); border: 2px solid transparent; transition: 0.3s; }
        .settings-box[data-chef="conservative"] #chef-desc { border-color: rgba(255, 107, 107, 0.3); background: rgba(255, 107, 107, 0.05); }
        .settings-box[data-chef="creative"] #chef-desc { border-color: rgba(155, 89, 182, 0.3); background: rgba(155, 89, 182, 0.05); }
        .settings-box[data-season="allowed"] #season-desc { border-color: rgba(255, 184, 0, 0.3); background: rgba(255, 184, 0, 0.05); }
        .settings-box[data-season="strict"] #season-desc { border-color: rgba(0, 184, 148, 0.3); background: rgba(0, 184, 148, 0.05); }
        
        /* í…ìŠ¤íŠ¸ ë¼ë²¨ í…Œë‘ë¦¬ */
        .toggle-label { 
            font-size: 0.95rem; font-weight: 500; color: #b2bec3; 
            transition: 0.3s; padding: 6px 12px; border-radius: 20px;
            border: 2px solid transparent; 
        }
        .toggle-label.active-creative { color: var(--creative-color); border-color: var(--creative-color); font-weight: 700; background-color: rgba(155, 89, 182, 0.05); }
        .toggle-label.active-conservative { color: var(--primary-color); border-color: var(--primary-color); font-weight: 700; background-color: rgba(255, 107, 107, 0.05); }
        .toggle-label.active-strict { color: var(--strict-color); border-color: var(--strict-color); font-weight: 700; background-color: rgba(0, 184, 148, 0.05); }
        .toggle-label.active-allowed { color: var(--secondary-color); border-color: var(--secondary-color); font-weight: 700; background-color: rgba(255, 165, 2, 0.05); }

        .divider { height: 1px; background: #e5e8eb; width: 100%; }

        #loading { display: none; text-align: center; padding: 40px 0; }
        .spinner { width: 48px; height: 48px; border: 5px solid #e5e8eb; border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-dots::after { content: ''; animation: dots 1.5s infinite; }
        @keyframes dots { 0% { content: ''; } 25% { content: '.'; } 50% { content: '..'; } 75% { content: '...'; } }

        /* ê²°ê³¼ ì¹´ë“œ */
        .recipe-card { background: var(--white); border-radius: var(--radius-l); overflow: hidden; margin-bottom: 24px; box-shadow: var(--shadow-card); cursor: pointer; transition: transform 0.2s; border: 2px solid transparent; }
        .recipe-card:hover { transform: translateY(-4px); border-color: var(--secondary-color); }
        .recipe-card.active { border-color: var(--primary-color); ring: 4px solid rgba(255,107,107,0.1); }

        .image-container { position: relative; width: 100%; height: 240px; background: #eee; overflow: hidden; }
        .dish-image { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s; }
        .img-source-btn { position: absolute; bottom: 12px; right: 12px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); color: white; padding: 6px 12px; border-radius: 16px; font-size: 0.75rem; font-weight: 600; border: none; display: flex; align-items: center; gap: 4px; transition: 0.2s; }
        .copy-btn-inline { display: inline-flex; align-items: center; gap: 4px; background-color: #f2f4f6; color: var(--text-sub); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; cursor: pointer; border: 1px solid #e5e8eb; margin-left: auto; transition: 0.2s; }
        
        .card-content { padding: 24px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dish-name { font-size: 1.5rem; font-weight: 800; color: var(--text-main); margin: 0; }
        .dish-style { font-size: 0.85rem; background: #fff8e1; color: #d35400; padding: 4px 8px; border-radius: 6px; font-weight: 600; }
        .card-info { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .level-badge { background: #f2f4f6; padding: 6px 12px; border-radius: 16px; font-size: 0.9rem; font-weight: 600; color: var(--text-sub); display: flex; align-items: center; gap: 6px; }
        .card-detail { display: none; margin-top: 20px; border-top: 1px solid #f2f4f6; padding-top: 20px; animation: fadeIn 0.3s; }
        .recipe-card.active .card-detail { display: block; }
        .reasoning { background: #f9fafb; padding: 16px; border-radius: 16px; color: #555; font-size: 0.95rem; line-height: 1.6; margin-bottom: 20px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        h4 { margin: 0; color: var(--text-main); font-size: 1.1rem; }
        ul.steps { padding: 0; list-style: none; margin: 0; }
        ul.steps li { padding: 12px 0; border-bottom: 1px solid #f2f4f6; display: flex; gap: 10px; line-height: 1.5; color: var(--text-main); }
        ul.steps li:before { content: "ğŸ³"; flex-shrink: 0; }
        ul.steps li:last-child { border-bottom: none; }

        .qa-section { margin-top: 24px; background: #f9fafb; padding: 16px; border-radius: 16px; }
        .qa-input-box { display: flex; gap: 8px; margin-top: 8px; }
        .qa-input { flex: 1; padding: 10px 14px; border: 1px solid #e5e8eb; border-radius: 12px; outline: none; }
        .qa-btn { background: var(--secondary-color); color: white; border: none; padding: 0 16px; border-radius: 12px; font-weight: 700; cursor: pointer; }
        .qa-answer { margin-top: 12px; padding: 12px; background: white; border-radius: 12px; border: 1px solid #e5e8eb; display: none; }
        .qa-answer.show { display: block; animation: fadeIn 0.3s; }

        .toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: rgba(25, 31, 40, 0.9); color: white; padding: 12px 20px; border-radius: 24px; font-weight: 600; box-shadow: 0 8px 24px rgba(0,0,0,0.12); opacity: 0; transform: translateY(20px); transition: all 0.3s; }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); /* ë°°ê²½ì„ ì§„í•˜ê²Œ ì–´ë‘¡ê²Œ */
            z-index: 9999; display: none;
            justify-content: center; align-items: center; animation: fadeIn 0.2s;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white; padding: 24px; border-radius: 24px;
            width: 90%; max-width: 360px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: left; animation: slideUp 0.3s;
        }
        .modal-title { font-size: 1.25rem; font-weight: 800; margin-bottom: 4px; color: var(--text-main); }
        .modal-desc { color: var(--text-sub); font-size: 0.9rem; margin-bottom: 20px; line-height: 1.5; }
        
        .api-input-group {
            display: flex; position: relative; margin-bottom: 15px;
        }
        .api-input-group input {
            flex: 1; padding: 12px 16px; padding-right: 130px; /* ë²„íŠ¼ ê³µê°„ í™•ë³´ */
            border: 1px solid #E5E8EB; border-radius: var(--radius-s); font-size: 0.95rem;
            font-family: monospace; color: var(--text-main);
        }
        .api-controls {
            position: absolute; right: 5px; top: 50%; transform: translateY(-50%); display: flex; gap: 5px;
        }
        .api-btn {
            background: #f2f4f6; color: var(--text-sub); border: none; padding: 6px 10px; border-radius: var(--radius-s);
            font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .api-btn:hover { background: #e5e8eb; }
        
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px; }
        .modal-btn { padding: 10px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; border: none; font-size: 0.95rem; }
        .modal-btn.cancel { background: #f2f4f6; color: var(--text-sub); }
        .modal-btn.confirm { background: var(--primary-color); color: white; }
        .modal-btn.logout { background: var(--primary-color); color: white; margin-left: 10px; }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ */
        .fixed-bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; display: flex; justify-content: center;
            padding: 15px 0; background: linear-gradient(to top, rgba(242,244,246,1) 70%, rgba(242,244,246,0));
            z-index: 999; pointer-events: none;
        }
        .info-button-container { pointer-events: all; }
        .info-button { background: var(--text-main); color: white; padding: 12px 24px; border-radius: 30px; font-weight: 600; font-size: 0.9rem; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; }
        .info-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25); }
        
        /* íˆ´íŒ ìŠ¤íƒ€ì¼ (í˜¸ë²„ ì‹œ í‘œì‹œ) */
        .info-tooltip {
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            margin-bottom: 10px; background: rgba(0,0,0,0.8); color: white;
            padding: 8px 12px; border-radius: 8px; font-size: 0.8rem;
            white-space: nowrap; opacity: 0; transition: opacity 0.2s; pointer-events: none;
        }
        .info-button-container:hover .info-tooltip { opacity: 1; }

    </style>
</head>
<body>

<div class="watermark">AIë©€í‹°ë¯¸ë””ì–´í™œìš©<br>2022706086 í•œì¤€í¬ ì „ìê³µí•™ê³¼</div>

<div class="container">
    <header>
        <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px;">
            <span class="chef-icon">ğŸ‘¨â€ğŸ³</span>
            <h1>AI ì…°í”„</h1>
        </div>
        <p class="subtitle">ëƒ‰ì¥ê³  ì† ì¬ë£Œë¡œ ì‹œì‘í•˜ëŠ” ìš”ë¦¬</p>
    </header>

    <!-- ì…ë ¥ ì„¹ì…˜ -->
    <div>
        <div class="input-container">
            <input type="text" id="ingredients" placeholder="ì¬ë£Œ ì…ë ¥ (ì˜ˆ: ê³„ë€, ì°¸ì¹˜)" onkeypress="if(event.key==='Enter') { getRecipe(); playSound('click'); }">
            <button class="clear-btn" onclick="clearInput(); playSound('click');" title="ì…ë ¥ ì´ˆê¸°í™”">âœ•</button>
            <button onclick="getRecipe(); playSound('click');" id="cookBtn">ìš”ë¦¬í•˜ê¸°</button>
        </div>
        
        <!-- ì¶”ì²œ ì¬ë£Œ ë°•ìŠ¤ -->
        <div class="recommend-box" style="margin-top: 16px; padding: 20px; border-radius: 24px; background: white; box-shadow: 0 2px 16px rgba(0,0,0,0.06);">
            <div class="recommend-title">ì¶”ì²œ ì¬ë£Œ</div>
            
            <!-- 1. ìƒìœ„ ì¹© -->
            <div class="chips-row">
                <div class="chip" onclick="toggleIngredient(this, 'ë°¥'); playSound('click');">ğŸš ë°¥</div>
                <div class="chip" onclick="toggleIngredient(this, 'ê³„ë€'); playSound('click');">ğŸ¥š ê³„ë€</div>
                <div class="chip" onclick="toggleIngredient(this, 'ê¹€ì¹˜'); playSound('click');">ğŸŒ¶ï¸ ê¹€ì¹˜</div>
                <div class="chip" onclick="toggleIngredient(this, 'ìŠ¤íŒ¸'); playSound('click');">ğŸ¥“ ìŠ¤íŒ¸</div>
                <div class="chip" onclick="toggleIngredient(this, 'ì°¸ì¹˜'); playSound('click');">ğŸŸ ì°¸ì¹˜</div>
            </div>
            
            <!-- 2. ì¹´í…Œê³ ë¦¬ ì¹© -->
            <div class="chips-row">
                <div class="chip category-chip" onclick="toggleCategory('meat'); playSound('click');" id="chip-meat">
                    ğŸ¥© ìœ¡ë¥˜ <span class="arrow-icon">â–¼</span>
                </div>
                <div class="chip category-chip" onclick="toggleCategory('fish'); playSound('click');" id="chip-fish">
                    ğŸŒŠ í•´ì‚°ë¬¼ <span class="arrow-icon">â–¼</span>
                </div>
                <div class="chip category-chip" onclick="toggleCategory('vege'); playSound('click');" id="chip-vege">
                    ğŸ¥¬ ì±„ì†Œ <span class="arrow-icon">â–¼</span>
                </div>
                <div class="chip category-chip" onclick="toggleCategory('dairy'); playSound('click');" id="chip-dairy">
                    ğŸ§€ ìœ ì œí’ˆ <span class="arrow-icon">â–¼</span>
                </div>
            </div>

            <!-- 3. í•˜ìœ„ ë©”ë‰´ -->
            <div id="sub-meat" class="main-category-container">
                <button class="sub-group-btn" onclick="toggleSubGroup('pork'); playSound('click');">
                    ğŸ· ë¼ì§€ê³ ê¸° <span id="arrow-pork" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-pork" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì‚¼ê²¹ì‚´'); playSound('click');">ì‚¼ê²¹ì‚´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ëª©ì‚´'); playSound('click');">ëª©ì‚´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ëŒ€íŒ¨ì‚¼ê²¹ì‚´'); playSound('click');">ëŒ€íŒ¨</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'í•­ì •ì‚´'); playSound('click');">í•­ì •ì‚´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê°ˆë§¤ê¸°ì‚´'); playSound('click');">ê°ˆë§¤ê¸°</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë“±ê°ˆë¹„'); playSound('click');">ë“±ê°ˆë¹„</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì•ë‹¤ë¦¬ì‚´'); playSound('click');">ì•ë‹¤ë¦¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë’·ë‹¤ë¦¬ì‚´'); playSound('click');">ë’·ë‹¤ë¦¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë¼ì§€ ë‹¤ì§ìœ¡'); playSound('click');">ë‹¤ì§ìœ¡</div>
                </div>

                <button class="sub-group-btn" onclick="toggleSubGroup('beef'); playSound('click');">
                    ğŸ® ì†Œê³ ê¸° <span id="arrow-beef" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-beef" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì†Œê³ ê¸° ë“±ì‹¬'); playSound('click');">ë“±ì‹¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì†Œê³ ê¸° ì•ˆì‹¬'); playSound('click');">ì•ˆì‹¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì±„ëì‚´'); playSound('click');">ì±„ë</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì°¨ëŒë°•ì´'); playSound('click');">ì°¨ëŒë°•ì´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì†Œê³ ê¸° ì–‘ì§€'); playSound('click');">ì–‘ì§€(êµ­ê±°ë¦¬)</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë¶ˆê³ ê¸°ìš© ì†Œê³ ê¸°'); playSound('click');">ë¶ˆê³ ê¸°ìš©</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì†Œê³ ê¸° ë‹¤ì§ìœ¡'); playSound('click');">ë‹¤ì§ìœ¡</div>
                </div>

                <!-- ë‹­ê³ ê¸° -->
                <button class="sub-group-btn" onclick="toggleSubGroup('chicken'); playSound('click');">
                    ğŸ” ë‹­ê³ ê¸° <span id="arrow-chicken" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-chicken" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹­ê°€ìŠ´ì‚´'); playSound('click');">ê°€ìŠ´ì‚´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹­ë‹¤ë¦¬'); playSound('click');">ë‹¤ë¦¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹­ë‚ ê°œ'); playSound('click');">ë‚ ê°œ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹­ì•ˆì‹¬'); playSound('click');">ì•ˆì‹¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹­ë³¶ìŒíƒ•ìš©'); playSound('click');">ë³¶ìŒíƒ•ìš©</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'í†µë‹­'); playSound('click');">í†µë‹­</div>
                </div>
            </div>

            <!-- í•´ì‚°ë¬¼ -->
            <div id="sub-fish" class="main-category-container">
                <!-- ì–´ë¥˜ -->
                <button class="sub-group-btn" onclick="toggleSubGroup('fish-fish'); playSound('click');">
                    ğŸŸ ì–´ë¥˜ <span id="arrow-fish-fish" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-fish-fish" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê³ ë“±ì–´'); playSound('click');">ê³ ë“±ì–´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê°ˆì¹˜'); playSound('click');">ê°ˆì¹˜</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì¡°ê¸°'); playSound('click');">ì¡°ê¸°</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì‚¼ì¹˜'); playSound('click');">ì‚¼ì¹˜</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì—°ì–´'); playSound('click');">ì—°ì–´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë™íƒœ'); playSound('click');">ë™íƒœ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì½”ë‹¤ë¦¬'); playSound('click');">ì½”ë‹¤ë¦¬</div>
                </div>

                <!-- í•´ì‚°ë¬¼/ì¡°ê°œ -->
                <button class="sub-group-btn" onclick="toggleSubGroup('fish-shell'); playSound('click');">
                    ğŸš ì¡°ê°œ/ê°‘ê°ë¥˜ <span id="arrow-fish-shell" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-fish-shell" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì˜¤ì§•ì–´'); playSound('click');">ì˜¤ì§•ì–´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìƒˆìš°'); playSound('click');">ìƒˆìš°</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë°”ì§€ë½'); playSound('click');">ë°”ì§€ë½</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'êµ´'); playSound('click');">êµ´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê½ƒê²Œ'); playSound('click');">ê½ƒê²Œ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì „ë³µ'); playSound('click');">ì „ë³µ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‚™ì§€'); playSound('click');">ë‚™ì§€</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì­ˆê¾¸ë¯¸'); playSound('click');">ì­ˆê¾¸ë¯¸</div>
                </div>

                <!-- ê°€ê³µ/ê±´ì–´ë¬¼ -->
                <button class="sub-group-btn" onclick="toggleSubGroup('fish-processed'); playSound('click');">
                    ğŸ¥ ê°€ê³µ/ê±´ì–´ë¬¼/í•´ì¡° <span id="arrow-fish-processed" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-fish-processed" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì–´ë¬µ'); playSound('click');">ì–´ë¬µ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê²Œë§›ì‚´'); playSound('click');">ê²Œë§›ì‚´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë©¸ì¹˜'); playSound('click');">ë©¸ì¹˜</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë¯¸ì—­'); playSound('click');">ë¯¸ì—­</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹¤ì‹œë§ˆ'); playSound('click');">ë‹¤ì‹œë§ˆ</div>
                </div>
            </div>

            <!-- ì±„ì†Œ (2ë‹¨ ë¶„ë¥˜) -->
            <div id="sub-vege" class="main-category-container">
                <button class="sub-group-btn" onclick="toggleSubGroup('root'); playSound('click');">
                    ğŸ§… ë¿Œë¦¬/ì¤„ê¸° ì±„ì†Œ <span id="arrow-root" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-root" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì–‘íŒŒ'); playSound('click');">ì–‘íŒŒ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ëŒ€íŒŒ'); playSound('click');">ëŒ€íŒŒ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë§ˆëŠ˜'); playSound('click');">ë§ˆëŠ˜</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê°ì'); playSound('click');">ê°ì</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‹¹ê·¼'); playSound('click');">ë‹¹ê·¼</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê³ êµ¬ë§ˆ'); playSound('click');">ê³ êµ¬ë§ˆ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë¬´'); playSound('click');">ë¬´</div>
                </div>

                <button class="sub-group-btn" onclick="toggleSubGroup('leaf'); playSound('click');">
                    ğŸ¥¬ ì/ì—´ë§¤ ì±„ì†Œ <span id="arrow-leaf" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-leaf" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë°°ì¶”'); playSound('click');">ë°°ì¶”</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìƒì¶”'); playSound('click');">ìƒì¶”</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê¹»ì'); playSound('click');">ê¹»ì</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì‹œê¸ˆì¹˜'); playSound('click');">ì‹œê¸ˆì¹˜</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì²­ê²½ì±„'); playSound('click');">ì²­ê²½ì±„</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìˆ™ì£¼'); playSound('click');">ìˆ™ì£¼</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì½©ë‚˜ë¬¼'); playSound('click');">ì½©ë‚˜ë¬¼</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì• í˜¸ë°•'); playSound('click');">ì• í˜¸ë°•</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì˜¤ì´'); playSound('click');">ì˜¤ì´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê³ ì¶”'); playSound('click');">ê³ ì¶”</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'íŒŒí”„ë¦¬ì¹´'); playSound('click');">íŒŒí”„ë¦¬ì¹´</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë²„ì„¯'); playSound('click');">ë²„ì„¯</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë¸Œë¡œì½œë¦¬'); playSound('click');">ë¸Œë¡œì½œë¦¬</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'í† ë§ˆí† '); playSound('click');">í† ë§ˆí† </div>
                </div>

                <button class="sub-group-btn" onclick="toggleSubGroup('tofu'); playSound('click');">
                    ğŸ¥£ ë‘ë¶€/ê°€ê³µ <span id="arrow-tofu" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-tofu" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë‘ë¶€'); playSound('click');">ë‘ë¶€</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìˆœë‘ë¶€'); playSound('click');">ìˆœë‘ë¶€</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìœ ë¶€'); playSound('click');">ìœ ë¶€</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ê³¤ì•½'); playSound('click');">ê³¤ì•½</div>
                </div>
            </div>
            
            <!-- ìœ ì œí’ˆ -->
            <div id="sub-dairy" class="main-category-container">
                <button class="sub-group-btn" onclick="toggleSubGroup('dairy-all'); playSound('click');">
                    ğŸ¥› ìœ ì œí’ˆ & ì¹˜ì¦ˆ <span id="arrow-dairy-all" class="sub-arrow">â–¼</span>
                </button>
                <div id="group-dairy-all" class="sub-chips-area">
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìš°ìœ '); playSound('click');">ìš°ìœ </div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì¹˜ì¦ˆ'); playSound('click');">ì¹˜ì¦ˆ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì²´ë‹¤ì¹˜ì¦ˆ'); playSound('click');">ì²´ë‹¤ì¹˜ì¦ˆ</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ëª¨ì§œë ë¼ì¹˜ì¦ˆ'); playSound('click');">ëª¨ì§œë ë¼</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìš”ê±°íŠ¸'); playSound('click');">ìš”ê±°íŠ¸</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ë²„í„°'); playSound('click');">ë²„í„°</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ìƒí¬ë¦¼'); playSound('click');">ìƒí¬ë¦¼</div>
                    <div class="sub-chip" onclick="toggleIngredient(this, 'ì—°ìœ '); playSound('click');">ì—°ìœ </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ì¹´ë“œ -->
    <div class="settings-box" id="settingsBox" data-chef="conservative" data-season="allowed">
        <div class="setting-row">
            <div class="toggle-wrapper">
                <div class="toggle-bg chef-bg"></div>
                <div class="toggle-option opt-creative" onclick="setChefMode(true)">ğŸ¨ ì°½ì˜ì  ì…°í”„</div>
                <div class="toggle-option opt-conservative" onclick="setChefMode(false)">ğŸ‘¨â€ğŸ³ ì •ì„ ì…°í”„</div>
            </div>
            <!-- ì´ˆê¸° í…ìŠ¤íŠ¸ ë™ê¸°í™” ì™„ë£Œ -->
            <div id="chef-desc" class="desc-box">
                ì´ ì…°í”„ëŠ” <b>ì‹¤íŒ¨ ì—†ëŠ” ë§›</b>ì„ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤.<br>ëˆ„êµ¬ë‚˜ ì¢‹ì•„í•˜ëŠ” ê²€ì¦ëœ í‘œì¤€ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.
            </div>
        </div>

        <div class="divider"></div>

        <div class="setting-row">
            <div class="toggle-wrapper">
                <div class="toggle-bg season-bg"></div>
                <div class="toggle-option opt-strict" onclick="setSeasonMode(false)">ğŸ§Š ì¬ë£Œë§Œ (ì—„ê²©)</div>
                <div class="toggle-option opt-allowed" onclick="setSeasonMode(true)">ğŸ§‚ ì¡°ë¯¸ë£Œ í—ˆìš©</div>
            </div>
            <!-- ì´ˆê¸° í…ìŠ¤íŠ¸ ë™ê¸°í™” ì™„ë£Œ -->
            <div id="season-desc" class="desc-box">
                <b>ê°„ì¥, êµ´ì†ŒìŠ¤, ë§ˆìš”ë„¤ì¦ˆ, ì¹˜í‚¨ìŠ¤í†¡</b> ë“± ë‹¤ì–‘í•œ ì–‘ë…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>ë” í’ë¶€í•˜ê³  ë§›ìˆëŠ” ìš”ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <div id="loading">
        <div class="spinner"></div>
        <p>ì…°í”„ê°€ ë©”ë‰´ë¥¼ êµ¬ìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤<span class="loading-dots"></span></p>
    </div>

    <div id="result-area" style="display:none;">
        <h3 style="text-align:center; color:var(--text-main); margin-bottom: 16px;">ğŸ½ï¸ ì¶”ì²œ ë©”ë‰´</h3>
        <div id="cards-container"></div>
    </div>
</div>

<!-- í•˜ë‹¨ ê³ ì • ë°” (API Key ê´€ë¦¬ ë²„íŠ¼) -->
<div class="fixed-bottom-bar">
    <div class="info-button-container">
        <button class="info-button" onclick="openKeyManagementModal(); playSound('click');">
            ğŸ”‘ API Key ê´€ë¦¬
        </button>
        <div class="info-tooltip">
            í‚¤ ìƒíƒœ: <span id="key-status">ë¯¸ì…ë ¥</span>
        </div>
    </div>
</div>


<div class="toast-container" id="toastContainer"></div>

<!-- [1] API Key ì…ë ¥ ëª¨ë‹¬ -->
<div id="apiKeyModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title">Gemini API Key ì…ë ¥</div>
        <p class="modal-desc">
            AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ API Keyê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
            í‚¤ëŠ” ë¸Œë¼ìš°ì €ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.
        </p>
        
        <div class="api-input-group">
            <input type="password" id="apiKeyModalInput" placeholder="AIzaSy..." value="" oninput="validateAndSaveKey(this.value)">
            <div class="api-controls">
                <button class="api-btn" onclick="toggleKeyVisibility(this)">ğŸ‘ï¸ ë³´ê¸°</button>
                <button class="api-btn" onclick="pasteKey()">ğŸ“‹ Paste</button>
            </div>
        </div>

        <div class="modal-buttons">
            <!-- confirm ë²„íŠ¼ì˜ disabled ì†ì„± ì œê±° (ì…ë ¥ê°’ ìˆìœ¼ë©´ í™œì„±í™”ë˜ë„ë¡ JSì—ì„œ ì œì–´í•˜ì§€ë§Œ ì´ˆê¸°ì—” ë¹„í™œì„±) -->
            <button class="modal-btn confirm" id="apiKeySaveBtn" disabled onclick="saveAndCloseKeyModal()">ì €ì¥í•˜ê³  ì‹œì‘</button>
        </div>
    </div>
</div>

<!-- [2] API Key ê´€ë¦¬/ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ (NEW) -->
<div id="keyManagementModal" class="modal-overlay" onclick="if(event.target===this) this.style.display='none'">
    <div class="modal-content">
        <div class="modal-title">ğŸ”‘ í˜„ì¬ API Key ê´€ë¦¬</div>
        <p class="modal-desc">
            í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜, ë¡œì»¬ ì €ì¥ì†Œì—ì„œ í‚¤ë¥¼ ì œê±°í•˜ì—¬ ë¡œê·¸ì•„ì›ƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        
        <div class="api-input-group" style="margin-bottom: 20px;">
            <input type="password" id="keyDisplayInput" readonly value="" style="color:var(--text-main); background:#F9FAFB;">
            <div class="api-controls">
                <button class="api-btn" onclick="toggleKeyDisplayVisibility(this)">ğŸ‘ï¸ ë³´ê¸°</button>
            </div>
        </div>
        
        <div class="modal-buttons">
            <button class="modal-btn cancel" onclick="document.getElementById('keyManagementModal').style.display='none'; playSound('click');">ë‹«ê¸°</button>
            <button class="modal-btn logout" onclick="logoutAndDeleteKey(); playSound('click');">ë¡œê·¸ì•„ì›ƒ (í‚¤ ì œê±°)</button>
        </div>
    </div>
</div>


<!-- ê¸°ì¡´ ëª¨ë‹¬ë“¤ -->
<div id="linkModal" class="modal-overlay" onclick="if(event.target===this) closeLinkModal()">
    <div class="modal-content">
        <div class="modal-title">ì™¸ë¶€ ë§í¬ ì´ë™</div>
        <p class="modal-desc">ì´ë¯¸ì§€ ì¶œì²˜ í™•ì¸ì„ ìœ„í•´<br>Bing ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <div class="modal-btn-group">
            <button class="modal-btn cancel" onclick="closeLinkModal(); playSound('click');">ì·¨ì†Œ</button>
            <button class="modal-btn confirm" onclick="confirmLinkMove(); playSound('click');">ì´ë™</button>
        </div>
    </div>
</div>

<!-- ë ˆë²¨ ì •ë³´ ëª¨ë‹¬ -->
<div id="infoModal" class="modal-overlay" onclick="if(event.target===this) this.style.display='none'">
    <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('infoModal').style.display='none'">&times;</span>
        <div id="modalTitle" class="modal-title"></div>
        <ul id="modalList" class="level-list"></ul>
    </div>
</div>

<script>
    // [ì¤‘ìš”] GitHub Pages ë°°í¬ ì‹œ Replit ë°±ì—”ë“œ ì£¼ì†Œë¡œ ì„¤ì • í•„ìš”
    // ë¡œì»¬/Replit í™˜ê²½ì—ì„œëŠ” ë¹ˆ ë¬¸ìì—´("")ë¡œ ë‘ë©´ ìë™ìœ¼ë¡œ í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš©
    const SERVER_URL = "https://e28ffa45-0145-4d76-b607-4ba880652163-00-vu6co7zf1wbl.pike.replit.dev"; 

    const clickSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
    clickSound.volume = 0.4;
    function playSound(type) { if(type==='click') { clickSound.currentTime=0; clickSound.play().catch(()=>{}); } }

    let state = { isCreative: false, isAllowed: true };
    let selectedIngredients = new Set();
    const API_KEY_STORAGE_KEY = 'gemini_api_key';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ API Key ì²´í¬
    window.addEventListener('DOMContentLoaded', () => {
        const storedKey = localStorage.getItem(API_KEY_STORAGE_KEY);
        if (storedKey) {
            // í‚¤ê°€ ìˆìœ¼ë©´: ëª¨ë‹¬ ë‹«ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('apiKeyModal').style.display = 'none';
            document.getElementById('apiKeyModalInput').value = storedKey;
            updateKeyStatus(true);
        } else {
            // í‚¤ê°€ ì—†ìœ¼ë©´: [í•µì‹¬] ì…ë ¥ ëª¨ë‹¬ ê°•ì œ í‘œì‹œ (ë‹«ê¸° ë²„íŠ¼ ì—†ìŒ)
            document.getElementById('apiKeyModal').style.display = 'flex';
            updateKeyStatus(false);
        }

        // ì´ˆê¸° UI ìƒíƒœ ì—…ë°ì´íŠ¸
        updateChefUI();
        updateSeasoningUI();
    });

    // API Key ìƒíƒœ ì—…ë°ì´íŠ¸ (íˆ´íŒ í…ìŠ¤íŠ¸ ë³€ê²½)
    function updateKeyStatus(hasKey) {
        const statusSpan = document.getElementById('key-status');
        if (hasKey) {
            statusSpan.innerText = 'ì…ë ¥ë¨ (í´ë¦­í•˜ì—¬ ê´€ë¦¬)';
            statusSpan.style.color = '#00B894'; 
        } else {
            statusSpan.innerText = 'ë¯¸ì…ë ¥ (í´ë¦­í•˜ì—¬ ì…ë ¥)';
            statusSpan.style.color = '#ff6b6b'; 
        }
    }

    // API Key ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
    function openKeyManagementModal() {
        const modal = document.getElementById('keyManagementModal');
        const displayInput = document.getElementById('keyDisplayInput');
        const storedKey = localStorage.getItem(API_KEY_STORAGE_KEY) || '';

        displayInput.value = storedKey;
        displayInput.type = storedKey ? 'password' : 'text'; 
        modal.querySelector('.api-controls .api-btn').innerText = 'ğŸ‘ï¸ ë³´ê¸°'; 
        modal.style.display = 'flex';
    }
    
    function toggleKeyDisplayVisibility(btn) {
        const input = document.getElementById('keyDisplayInput');
        if (input.type === 'password') { input.type = 'text'; btn.innerText = 'ğŸ”’ ìˆ¨ê¹€'; } 
        else { input.type = 'password'; btn.innerText = 'ğŸ‘ï¸ ë³´ê¸°'; }
        playSound('click');
    }

    // [í•µì‹¬] ë¡œê·¸ì•„ì›ƒ: í‚¤ ì‚­ì œ í›„ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
    function logoutAndDeleteKey() {
        localStorage.removeItem(API_KEY_STORAGE_KEY);
        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
        location.reload(); // ìƒˆë¡œê³ ì¹¨
    }

    // [í•µì‹¬] API Key ê²€ì¦ ë° ì €ì¥ ì‹œë„ (ì–‘ì‹ë§Œ ë§ìœ¼ë©´ í†µê³¼)
    async function saveAndCloseKeyModal() {
        const key = document.getElementById('apiKeyModalInput').value.trim();
        
        // 1. í˜•ì‹ ê²€ì¦ (ìœ íš¨ì„± ê²€ì‚¬ëŠ” ë°±ì—”ë“œì—ê²Œ ì™„ì „íˆ ìœ„ì„)
        if (!key || key.length < 30 || !key.startsWith('AIza')) {
            alert('ìœ íš¨í•˜ì§€ ì•Šì€ API Key í˜•ì‹ì…ë‹ˆë‹¤.\n(AIza...ë¡œ ì‹œì‘í•˜ë©° 30ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤)');
            return;
        }

        // 2. í˜•ì‹ë§Œ ë§ìœ¼ë©´ ë°”ë¡œ ì €ì¥í•˜ê³  ëª¨ë‹¬ ë‹«ê¸° (ì‹¤ì œ ê²€ì¦ì€ ë‚˜ì¤‘ì—)
        localStorage.setItem(API_KEY_STORAGE_KEY, key);
        document.getElementById('apiKeyModal').style.display = 'none';
        updateKeyStatus(true);
        showToast('API Keyê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. AI ê¸°ëŠ¥ ì‚¬ìš© ì‹œ ê²€ì¦ë©ë‹ˆë‹¤.');

    }

    function validateAndSaveKey(key) {
        const saveBtn = document.getElementById('apiKeySaveBtn');
        const isValid = key.trim().length > 30 && key.startsWith('AIza');
        saveBtn.disabled = !isValid;
    }
    
    function toggleKeyVisibility(btn) {
        const input = document.getElementById('apiKeyModalInput');
        if (input.type === 'password') { input.type = 'text'; btn.innerText = 'ğŸ”’ ìˆ¨ê¹€'; } 
        else { input.type = 'password'; btn.innerText = 'ğŸ‘ï¸ ë³´ê¸°'; }
        playSound('click');
    }

    function pasteKey() {
        if (navigator.clipboard && navigator.clipboard.readText) {
            navigator.clipboard.readText().then(text => {
                const input = document.getElementById('apiKeyModalInput');
                input.value = text.trim();
                validateAndSaveKey(text.trim());
                showToast('í´ë¦½ë³´ë“œì—ì„œ í‚¤ë¥¼ ë¶™ì—¬ë„£ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => { showToast('í´ë¦½ë³´ë“œ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.'); });
        } else { showToast('í´ë¦½ë³´ë“œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
        playSound('click');
    }

    // --- (ë‚˜ë¨¸ì§€ ë¡œì§ ìœ ì§€) ---

    function addIngredient(name) { const input = document.getElementById('ingredients'); const currentVal = input.value.trim(); if (currentVal) input.value = currentVal + ', ' + name; else input.value = name; }
    function toggleIngredient(el, name) { if (selectedIngredients.has(name)) { selectedIngredients.delete(name); el.classList.remove('pressed'); } else { selectedIngredients.add(name); el.classList.add('pressed'); } updateInput(); }
    function updateInput() { const input = document.getElementById('ingredients'); if (selectedIngredients.size > 0) { input.value = Array.from(selectedIngredients).join(', '); } else { input.value = ''; } }
    function clearInput() { selectedIngredients.clear(); document.getElementById('ingredients').value = ''; document.querySelectorAll('.chip, .sub-chip').forEach(el => el.classList.remove('pressed')); }
    function toggleCategory(id) { const subMenu = document.getElementById('sub-' + id); const chip = document.getElementById('chip-' + id); const isVisible = subMenu.classList.contains('open'); document.querySelectorAll('.main-category-container').forEach(el => el.classList.remove('open')); document.querySelectorAll('.category-chip').forEach(el => el.classList.remove('active')); if (!isVisible) { subMenu.classList.add('open'); chip.classList.add('active'); } }
    function toggleSubGroup(id) { const groupArea = document.getElementById('group-' + id); const arrow = document.getElementById('arrow-' + id); const btn = arrow.parentElement; const isVisible = groupArea.classList.contains('open'); if (isVisible) { groupArea.classList.remove('open'); btn.classList.remove('active'); } else { groupArea.classList.add('open'); btn.classList.add('active'); } }
    function updateChefUI() { const box = document.getElementById('settingsBox'); const toggle = box.querySelector('#chefToggle'); const desc = document.getElementById('chef-desc'); if(state.isCreative) { box.dataset.chef = "creative"; desc.innerHTML = `ì´ ì…°í”„ëŠ” <b>ì„¸ìƒì— ì—†ë˜ ìš”ë¦¬</b>ë¥¼ ë§Œë“­ë‹ˆë‹¤.<br>ë…ì°½ì ì¸ ë§›ì˜ ì¡°í•©ì„ ì œì•ˆí•©ë‹ˆë‹¤.`; } else { box.dataset.chef = "conservative"; desc.innerHTML = `ì´ ì…°í”„ëŠ” <b>ì‹¤íŒ¨ ì—†ëŠ” ë§›</b>ì„ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤.<br>ëˆ„êµ¬ë‚˜ ì¢‹ì•„í•˜ëŠ” ê²€ì¦ëœ í‘œì¤€ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.`; } }
    function updateSeasoningUI() { const box = document.getElementById('settingsBox'); const toggle = box.querySelector('#seasoningToggle'); const desc = document.getElementById('season-desc'); if(state.isAllowed) { box.dataset.season = "allowed"; desc.innerHTML = `<b>ê°„ì¥, êµ´ì†ŒìŠ¤, ë§ˆìš”ë„¤ì¦ˆ, ì¹˜í‚¨ìŠ¤í†¡</b> ë“± ë‹¤ì–‘í•œ ì–‘ë…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>ë” í’ë¶€í•˜ê³  ë§›ìˆëŠ” ìš”ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`; } else { box.dataset.season = "strict"; desc.innerHTML = `ì˜¤ì§ <b>ì…ë ¥í•œ ì¬ë£Œ</b>ì™€ <b>ë¬¼, ì†Œê¸ˆ, í›„ì¶”</b>ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>(ì¬ë£Œ ë³¸ì—°ì˜ ë§› ëª¨ë“œ)`; } }

    async function getRecipe() {
        const apiKey = localStorage.getItem(API_KEY_STORAGE_KEY);
        if (!apiKey) {
            // í‚¤ê°€ ì—†ìœ¼ë©´ alert í›„ ìƒˆë¡œê³ ì¹¨
            alert('API Key ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            document.getElementById('apiKeyModal').style.display = 'flex';
            return;
        }
        const input = document.getElementById('ingredients');
        const rawInput = input.value.split(',').map(s => s.trim()).filter(s => s);
        rawInput.forEach(s => selectedIngredients.add(s));
        if(!input.value.trim()) { showToast('ì¬ë£Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
        const btn = document.getElementById('cookBtn');
        const loading = document.getElementById('loading');
        const resultArea = document.getElementById('result-area');
        const cardsContainer = document.getElementById('cards-container');
        btn.disabled = true; btn.innerText = "ìš”ë¦¬ ì¤‘...";
        loading.style.display = 'block'; resultArea.style.display = 'none';
        cardsContainer.innerHTML = '';
        try {
            // [ì¤‘ìš”] SERVER_URL ì‚¬ìš©
            const response = await fetch(`${SERVER_URL}/generate`, { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify({ api_key: apiKey, ingredients: input.value, is_creative_mode: state.isCreative, allow_seasoning: state.isAllowed }) 
            });
            
            if (response.status === 401 || response.status === 503) { 
                const errorText = (await response.json()).error;
                alert(`AI ìš”ì²­ ì‹¤íŒ¨: ${errorText}\n\ní‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ì¬ì‹œë„í•´ì£¼ì„¸ìš”.`); 
                if (response.status === 401) {
                   localStorage.removeItem(API_KEY_STORAGE_KEY);
                }
                location.reload(); 
                return; 
            }

            const data = await response.json();

            if(data.error) { alert(data.error); }
            else if(data.recommendations) {
                data.recommendations.forEach((dish, idx) => createCard(dish, idx));
                resultArea.style.display = 'block';
                showToast("ìš”ë¦¬ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
            }
        } catch(e) { console.error(e); showToast("ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
        finally { btn.disabled = false; btn.innerText = "ìš”ë¦¬í•˜ê¸°"; loading.style.display = 'none'; }
    }

    function copyRecipeData(btn) { if (event) event.stopPropagation(); playSound('click'); const dishName = btn.dataset.name; let steps = []; try { steps = JSON.parse(btn.dataset.steps); } catch(e) { return; } const text = `[AI ì…°í”„ì˜ ì¶”ì²œ ë ˆì‹œí”¼: ${dishName}]\n\n${steps.map((step, i) => `${i+1}. ${step}`).join('\n')}`; if (navigator.clipboard && navigator.clipboard.writeText) { navigator.clipboard.writeText(text).then(() => showToast("ë ˆì‹œí”¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!")).catch(() => fallbackCopyTextToClipboard(text)); } else { fallbackCopyTextToClipboard(text); } }
    function fallbackCopyTextToClipboard(text) { const textArea = document.createElement("textarea"); textArea.value = text; textArea.style.position = "fixed"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showToast("ë ˆì‹œí”¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); } catch (err) { showToast("ë³µì‚¬ ì‹¤íŒ¨"); } document.body.removeChild(textArea); }
    let targetLink = "";
    function openLinkModal(url) { targetLink = url; document.getElementById('linkModal').style.display = 'flex'; playSound('click'); }
    function closeLinkModal() { document.getElementById('linkModal').style.display = 'none'; targetLink = ""; }
    function confirmLinkMove() { if(targetLink) window.open(targetLink, '_blank'); closeLinkModal(); }
    function createCard(dish, idx) { const container = document.getElementById('cards-container'); const card = document.createElement('div'); card.className = 'recipe-card'; card.onclick = function(e) { if(['BUTTON','INPUT'].includes(e.target.tagName) || e.target.closest('.img-source-btn') || e.target.closest('.copy-btn-inline')) return; playSound('click'); document.querySelectorAll('.recipe-card').forEach(c => c.classList.remove('active')); this.classList.add('active'); }; const query = dish.dish_name_en || dish.dish_name; const encodedQuery = encodeURIComponent(query + ' dish food'); const imgUrl = `https://tse4.mm.bing.net/th?q=${encodedQuery}&w=800&h=600&c=7&rs=1`; const searchUrl = `https://www.bing.com/images/search?q=${encodedQuery}&qft=+filterui:license-L2_L3_L4`; const stepsHtml = dish.recipe_steps.map(s => `<li>${s}</li>`).join(''); const qInputId = `q-${idx}`; const qAnsId = `a-${idx}`; const stepsJson = JSON.stringify(dish.recipe_steps).replace(/"/g, '&quot;'); const calInfo = getCalorieInfo(dish.calories); const diffInfo = getDiffInfo(dish.difficulty); card.innerHTML = `<div class="image-container"><img src="${imgUrl}" class="dish-image" onerror="this.src='https://via.placeholder.com/800x600?text=No+Image';"><button class="img-source-btn" onclick="event.stopPropagation(); openLinkModal('${searchUrl}')">ğŸ” ê²€ìƒ‰ ì´ë¯¸ì§€ ì¶œì²˜</button></div><div class="card-content"><div class="card-header"><span class="dish-name">${dish.dish_name}</span><span class="dish-style">${dish.style}</span></div><div class="card-info"><span class="level-badge diff-badge" onclick="showLevelInfo('diff', ${diffInfo.level})">âš¡ ${diffInfo.text}</span><span class="level-badge cal-badge" onclick="showLevelInfo('cal', ${calInfo.level})">ğŸ”¥ ${calInfo.text}</span></div><div class="card-detail"><div class="reasoning">${dish.reasoning}</div><div class="section-header"><h4>ğŸ“ ì¡°ë¦¬ ìˆœì„œ</h4><button class="copy-btn-inline" data-name="${dish.dish_name}" data-steps="${stepsJson}" onclick="copyRecipeData(this)">ğŸ“‹ ë³µì‚¬</button></div><ul class="steps">${stepsHtml}</ul><div class="qa-section"><div style="font-weight:700; color:var(--secondary-color); margin-bottom:8px;">ğŸ‘¨â€ğŸ³ ì…°í”„ì—ê²Œ ì§ˆë¬¸í•˜ê¸°</div><div class="qa-input-box"><input type="text" id="${qInputId}" class="qa-input" placeholder="ì˜ˆ: ë¶ˆ ì¡°ì ˆì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?"><button class="qa-btn" onclick="askChef('${dish.dish_name}', '${qInputId}', '${qAnsId}')">ì§ˆë¬¸</button></div><div id="${qAnsId}" class="qa-answer"></div></div></div></div>`; container.appendChild(card); }
    
    async function askChef(dish, inId, ansId) { 
        const apiKey = localStorage.getItem(API_KEY_STORAGE_KEY); 
        if (!apiKey) { alert('API Key ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.'); location.reload(); return; } 
        const input = document.getElementById(inId); 
        const ansBox = document.getElementById(ansId); 
        if(!input.value.trim()) return; 
        playSound('click'); 
        ansBox.style.display = 'block'; 
        ansBox.innerText = "ë‹µë³€ ìƒì„± ì¤‘..."; 
        ansBox.classList.add('show'); 
        try { 
            // [ì¤‘ìš”] SERVER_URL ì‚¬ìš©
            const res = await fetch(`${SERVER_URL}/ask`, { 
                method: 'POST', 
                headers: {'Content-Type':'application/json'}, 
                body: JSON.stringify({api_key: apiKey, dish_name: dish, question: input.value})
            }); 
            
            if (res.status === 401 || res.status === 503) { 
                const errorText = (await res.json()).error;
                alert(`AI ìš”ì²­ ì‹¤íŒ¨: ${errorText}`); 
                if (res.status === 401) localStorage.removeItem(API_KEY_STORAGE_KEY);
                location.reload(); 
                return; 
            }

            const data = await res.json(); 
            ansBox.innerText = "ğŸ—£ï¸ " + data.answer; 
        } catch(e) { ansBox.innerText = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."; } 
    }

    const CALORIE_LEVELS = [ { level: 1, text: "ğŸŒ¿ ìˆ¨ë§Œ ì‰¬ì–´ë„ ì‚´ ì•ˆ ì°œ (300kcal ë¯¸ë§Œ)" }, { level: 2, text: "ğŸ¥— ê°€ë²¼ìš´ í•œ ë¼ (300~600kcal)" }, { level: 3, text: "ğŸš ë“ ë“ í•œ ì§‘ë°¥ (600~900kcal)" }, { level: 4, text: "ğŸ– ë§›ìˆìœ¼ë©´ 0ì¹¼ë¡œë¦¬ (900~1400kcal)" }, { level: 5, text: "ğŸš¨ ë±ƒì‚´ ê²½ë³´ ë°œë ¹ (1400kcal ì´ìƒ)" } ]; const DIFF_LEVELS = [ { level: 1, text: "ğŸ‘¶ ë¼ë©´ë³´ë‹¤ ì‰¬ì›€ (í•˜)" }, { level: 2, text: "ğŸ”ª ì¹¼ì§ˆë§Œ ì¡°ì‹¬í•´ (ì¤‘í•˜)" }, { level: 3, text: "ğŸ  ë‚˜ë„ ì´ì œ ìš”ë¦¬ì‚¬ (ì¤‘)" }, { level: 4, text: "ğŸ”¥ ë¶ˆì¡°ì ˆì´ ê´€ê±´ (ì¤‘ìƒ)" }, { level: 5, text: "ğŸ‘¨â€ğŸ³ ì…°í”„ì˜ ë„ì „ (ìƒ)" } ]; function getCalorieInfo(kcalStr) { const matches = String(kcalStr).match(/\d+/g); let kcal = 0; if (matches && matches.length > 0) { if (matches.length === 1) { kcal = parseInt(matches[0]); } else { let sum = 0; matches.forEach(n => sum += parseInt(n)); kcal = sum / matches.length; } } let lvl = 3; if (kcal === 0) lvl = 3; else if (kcal < 300) lvl = 1; else if (kcal < 600) lvl = 2; else if (kcal < 900) lvl = 3; else if (kcal < 1400) lvl = 4; else lvl = 5; return CALORIE_LEVELS[lvl-1]; } function getDiffInfo(diffStr) { const s = String(diffStr).trim(); if (s.includes("ìµœìƒ") || s.includes("ê·¹ìƒ")) return DIFF_LEVELS[4]; if (s.includes("ì¤‘ìƒ")) return DIFF_LEVELS[3]; if (s.includes("ì¤‘í•˜")) return DIFF_LEVELS[1]; if (s.includes("ìƒ")) return DIFF_LEVELS[4]; if (s.includes("ì¤‘")) return DIFF_LEVELS[2]; if (s.includes("í•˜")) return DIFF_LEVELS[0]; return DIFF_LEVELS[2]; } function showLevelInfo(type, currentLevel) { const modal = document.getElementById('infoModal'); const title = document.getElementById('modalTitle'); const list = document.getElementById('modalList'); let data = []; if (type === 'cal') { title.innerText = "ğŸ“Š ì¹¼ë¡œë¦¬ 5ë‹¨ê³„ ê°€ì´ë“œ"; data = CALORIE_LEVELS; } else { title.innerText = "ğŸ”¥ ë‚œì´ë„ 5ë‹¨ê³„ ê°€ì´ë“œ"; data = DIFF_LEVELS; } list.innerHTML = ''; data.forEach(item => { const li = document.createElement('li'); li.className = 'level-item'; if (item.level === currentLevel) li.classList.add('active'); li.innerHTML = `<span class="level-num">Lv.${item.level}</span> ${item.text}`; list.appendChild(li); }); modal.style.display = 'flex'; }
</script>
</body>
</html>